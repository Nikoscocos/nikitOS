<contents>
    <div class="nonceblank"></div>
</contents>
<onstart>
    async function updateProcessList(cid) {
        alltasks = vfs.vmem.windows.length + Object.keys(vfs.vmem.kernel.threads).length + Object.keys(vfs.vmem.kernel.proc).length;
        vmemsize = await webfs.getSize(JSON.stringify(vfs.vmem).length);
        vmembytes = JSON.stringify(vfs.vmem).length;
        appcontent = `<div class="nonceblank"><div class="bottom-bar">vmem: ${vmemsize} · bytes: ${vmembytes}<eq right>${alltasks} tasks</eq></div>`;
        for (let wid in vfs.vmem.windows) {
            thiswin = vfs.vmem.windows[wid];
            if (thiswin.realid == vfs.vmem.activewindow) { sel = ' selected'; }
            else { sel = ''; }
            appcontent = appcontent + `
                <div class="optionchance" id="${thiswin['hash']}_${String(thiswin['realid'])}"${sel}>
                    <img src="${thiswin['icon']}">
                    <div>
                        <button right onclick="doWithWindow('${thiswin['realid']}', 'close')">Stop</button>
                        <p class="optitle">${thiswin['title']}</p>
                        <p class="opdesc">PID: ${thiswin['realid']} · ${thiswin['author']}</p>
                    </div>
                </div>
            `;
        }
        for (let wid in vfs.vmem.kernel.threads) {
            thiswin = vfs.vmem.kernel.threads[wid];
            appcontent = appcontent + `
                <div class="optionchance">
                    <img src="apps/jsrun/icon.png">
                    <div>
                        <button right onclick="kernel.stopThread('${wid}')">Stop</button>
                        <p class="optitle">${thiswin['name']}</p>
                        <p class="opdesc">Thread process (${thiswin['id']}:${wid})</p>
                    </div>
                </div>
            `;
        }
        changeWindowContent(cid, appcontent + '</div>');
    }
    thisww = getWindowById(vfs.vmem.windowcounts);
    vfs.vmem.svcache[thisww['hash'] + '_worker'] = window.createInterval(function(data, interval) {
        updateProcessList(String(getWindowByHash(data)['realid']));
    }, 1000, thisww['hash']);
</onstart>
<onclose>
    selelem = wncfg['hash'] + '_worker';
    if (selelem in vfs.vmem.svcache) {
        window.clearInterval(vfs.vmem.svcache[selelem]);
        vfs.vmem.svcache[selelem] = null;
        delete vfs.vmem.svcache[selelem];
    }
</onclose>